<launch>
    <!-- 真机测试 - 通过WiFi连接Pixhawk
         ESP8266配置：IP 192.168.4.1, Port 14550 -->
    
    <!-- 测试参数 - 首次测试使用保守值 -->
    
    <!-- WiFi连接参数 -->
    <arg name="fcu_url" default="udp://:14550@192.168.4.1:14550"/>
    
    <!-- ========================================
         启动MAVROS
         ======================================== -->
    <include file="$(find mavros)/launch/px4.launch">
        <arg name="fcu_url" value="$(arg fcu_url)"/>
        <arg name="gcs_url" value=""/>
        <arg name="tgt_system" value="1"/>
        <arg name="tgt_component" value="1"/>
    </include>
    
    <!-- ========================================
         安全检查节点（监控状态）
         ======================================== -->
    <!-- <node name="safety_monitor" pkg="rostopic" type="rostopic" 
          args="echo /mavros/state -c"
          output="screen"/> -->
    
    <!-- ========================================
         启动测试节点（大幅延迟，留出检查时间）
         ======================================== -->


    <node name="circle" pkg="real_test" type="circle_node" output="screen"
        launch-prefix="bash -c 'sleep 5; $0 $@'">
        <!-- 飞行参数 -->
        <param name="takeoff_height" value="1.5"/>        <!-- 起飞高度：5米 -->
        <param name="circle_radius" value="3.0"/>         <!-- 圆圈半径：5米 -->
        <param name="flight_speed" value="1"/>          <!-- 飞行速度：0.5m/s -->
        <param name="waypoint_tolerance" value="0.3"/>    <!-- 航点容差：0.3米 -->
        <param name="num_waypoints" value="36"/>          <!-- 圆周航点数：36个（每10度一个） -->
        
        <!-- 圆心位置（相对于起飞点） -->
        <param name="circle_center_x" value="3.0"/>       <!-- 圆心在起飞点前方5米 -->
        <param name="circle_center_y" value="0.0"/>       <!-- 圆心在起飞点正前方 -->
    </node>
    
</launch>